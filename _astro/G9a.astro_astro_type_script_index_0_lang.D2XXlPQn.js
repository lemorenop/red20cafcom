import{B as m,C as y,f as u,G as d,s as A,I as P}from"./BaseChart.BPIYNeR_.js";import{q as f}from"./querySelectors.Qy2Qr1Pd.js";import{g as D}from"./colors.DR0mxEkc.js";const b={id:"averageLine",afterDatasetsDraw(p,n,e){const{ctx:t,scales:{x:r,y:i}}=p,c=r.getPixelForValue(e.xValue);t.save(),t.beginPath(),t.moveTo(c,i.top-5),t.lineTo(c,i.bottom),t.strokeStyle=e.color,t.lineWidth=1,t.stroke(),t.restore(),t.fillStyle=e.color,t.font="bold 12px Arial",t.textAlign="center",t.fillText(e.label,c,i.top-10)}};class l extends m{static PANEL_A="a";static PANEL_B="b";static DEFAULT_REGION="Todas";static DEFAULT_ZONE="Urbana";async initialize(){try{this.rawData=await this.fetchData(),this.chartPanelA=new y(f(this.container,".chart__canvas[data-chart-panel='a']"),{type:this.getType(),data:this.getDataPanelA(),options:this.getOptions(l.PANEL_A),plugins:this.getPlugins()}),this.chartPanelB=new y(f(this.container,".chart__canvas[data-chart-panel='b']"),{type:this.getType(),data:this.getDataPanelB(),options:this.getOptions(l.PANEL_B),plugins:this.getPlugins()})}catch(n){console.error(`Error initializing chart ${this.chartId}:`,n)}this.setupRegionSelect(),this.setupZoneSelect()}setupRegionSelect(){const n=[...new Set(this.rawData.filter(e=>e.country!==null).map(e=>e.region).filter(e=>!!e))].sort();this.regionSelect=this.container.querySelector("#regionSelect"),this.regionSelect&&(n.forEach(e=>{const t=document.createElement("option");t.value=this.t(e),t.textContent=this.t(e),this.regionSelect.appendChild(t)}),this.regionSelect.value=this.t(l.DEFAULT_REGION),this.regionSelect.addEventListener("change",()=>{this.updateChart()}))}setupZoneSelect(){const n=[...new Set(this.rawData.filter(e=>e.country!==null).map(e=>e.zone).filter(e=>!!e))].sort();this.zoneSelect=this.container.querySelector("#zone-select"),this.zoneSelect&&(n.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,this.zoneSelect.appendChild(t)}),this.zoneSelect.value=this.t(l.DEFAULT_ZONE),this.zoneSelect.addEventListener("change",()=>{this.updateChart()}))}updateChart(){const n=this.t(l.DEFAULT_REGION),e=this.zoneSelect.value;if(n&&e){const t=this.getOECDAverageByZone(e),r=t.find(c=>c.service===this.t("Agua potable")),i=t.find(c=>c.service===this.t("Saneamiento"));this.chartPanelA.data=this.getData(n,e,this.t("Agua potable")),this.chartPanelA.options.plugins.averageLine.xValue=r.percentage,this.chartPanelA.options.plugins.averageLine.label=u(r.percentage/100,{decimalPlaces:2,asPercentage:!0}),this.chartPanelB.data=this.getData(n,e,this.t("Saneamiento")),this.chartPanelB.options.plugins.averageLine.xValue=i.percentage,this.chartPanelB.options.plugins.averageLine.label=u(i.percentage/100,{decimalPlaces:2,asPercentage:!0}),this.chartPanelA.update(),this.chartPanelB.update()}}getType(){return"scatter"}getDataByRegionAndZone(n,e){return this.rawData.filter(t=>t.country!==null&&(n===this.t("Todas")||t.region===n)&&t.zone===e)}getData(n,e,t){const i=this.getDataByRegionAndZone(n,e).filter(a=>a.service===t).sort((a,s)=>a.year-s.year).reduce((a,s)=>(a.has(s.country)||a.set(s.country,[]),a.get(s.country).push(s),a),new Map),h=[...i.entries()].sort((a,s)=>{const o=a[1][a[1].length-1],g=s[1][a[1].length-1];return o.percentage-g.percentage}).reduce((a,[s,o])=>{const g=o[0].region;return a[g]||(a[g]=[]),a[g].push([s,o]),a},{}),v=[this.t("Caribe"),this.t("América del Sur"),this.t("América Central")];return i.clear(),v.forEach(a=>{h[a]&&(h[a].forEach(([s,o])=>{i.set(s,o)}),i.set(`#${Math.random()}`,[{country:null,percentage:null,year:null},{country:null,percentage:null,year:null}]))}),{labels:[...i.keys().map(a=>a.startsWith("#")?"":a)],datasets:[{label:d(t),data:[...i.entries().map(([a,s])=>{const o=s[0];return{x:o.percentage,y:a.startsWith("#")?"":a,year:o.year}})],pointRadius:4,pointHoverRadius:6,backgroundColor:D(2)},{label:d(t),data:[...i.entries().map(([a,s])=>{const o=s[s.length-1];return{x:o.percentage,y:a.startsWith("#")?"":a,year:o.year}})],pointRadius:4,pointHoverRadius:6,backgroundColor:D(1)}]}}getDataPanelA(){return this.getData(this.t(l.DEFAULT_REGION),this.t(l.DEFAULT_ZONE),this.t("Agua potable"))}getDataPanelB(){return this.getData(this.t(l.DEFAULT_REGION),this.t(l.DEFAULT_ZONE),this.t("Saneamiento"))}getOECDAverageByZone(n){return this.rawData.filter(e=>e.region===this.t("OCDE ingresos altos no ALyC")&&e.zone===n)}updateAverage(){this.zoneSelect.value||l.DEFAULT_ZONE,this.chart.options.plugins.averageLine.xValue="",this.chart.options.plugins.averageLine.label=""}getOptions(n){const e=n===l.PANEL_A?this.t("Agua potable"):this.t("Saneamiento"),t=this.getOECDAverageByZone(this.t(l.DEFAULT_ZONE)).find(r=>r.service===e);return this.mergeOptions(super.getOptions(),{maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1,axis:"y"},scales:{x:{min:0,suggestedMax:100,ticks:{callback:this.ticksAsPercentage()},title:{display:!0,text:e===this.t("Agua potable")?A(this.t("% de la población que utiliza servicios de agua potable gestionados de forma segura"),40):A(this.t("% de la población que utiliza servicios de saneamiento gestionados de forma segura"),40)}},y:{type:"category",ticks:{autoSkip:!1}}},plugins:{htmlLegend:{display:!1},legend:{display:!1},title:{display:!0,text:d(e),align:"end",padding:{bottom:32},font:{size:14,weight:"600"}},tooltip:{callbacks:{title:r=>r[0].label,label:r=>{let i=r.dataset.label||"";if(i&&r.parsed.x!==null){const c=r.dataset.data[r.dataIndex].year,h=u(r.parsed.x/100,{decimalPlaces:2,asPercentage:!0,locale:this.lang});i=`${this.t("Año")} ${c}: ${h}`}return i}}},averageLine:{xValue:t.percentage,color:"rgba(0, 0, 0, 0.4)",label:u(t.percentage/100,{decimalPlaces:2,asPercentage:!0,locale:this.lang})}}})}getPlugins(){return[...super.getPlugins(),P,b]}}function E(){try{new l("C1-G9a")}catch{}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",E):E();
